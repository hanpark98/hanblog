---
import Layout from '../layouts/Layout.astro';

const postFiles = Object.entries(import.meta.glob('../content/posts/*.md', { eager: true }));

const posts = postFiles.map(([path, post]) => ({
  slug: path.split('/').pop().replace('.md', ''),
  ...post.frontmatter
}));

// 카테고리 추출
const allCategories = [...new Set(posts.map(p => p.category ?? '기타'))];
---

<Layout title="Blog">

  <!-- 🔹 Navigation -->
  <div id="category-nav" class="flex flex-wrap gap-2 mb-8">
    <button class="category-btn px-4 py-2 border rounded active" data-category="all">모든 글</button>
    {allCategories.map(cat => (
      <button class="category-btn px-4 py-2 border rounded" data-category={cat}>{cat}</button>
    ))}
  </div>

  <!-- 🔹 포스트 목록 -->
  <div id="posts-wrapper" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    {posts.map(post => (
      <a 
        href={`/posts/${post.slug}`} 
        class="group block border rounded-lg overflow-hidden shadow-sm hover:shadow-lg transition-shadow duration-300 post-card"
        data-category={post.category ?? '기타'}
      >
        <div class="w-full aspect-square overflow-hidden">
          <img 
            src={post.image} 
            alt={post.title} 
            class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-300"
          />
        </div>
        <div class="p-4">
          <h3 class="text-base md:text-lg font-bold mb-1">{post.title}</h3>
          <p class="text-sm text-gray-600">{post.description}</p>
        </div>
      </a>
    ))}
  </div>

  <!-- 🔹 필터 스크립트 -->
  <script>
    const buttons = document.querySelectorAll('.category-btn');
    const posts = document.querySelectorAll('.post-card');

    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        // 버튼 활성화 표시
        buttons.forEach(b => b.classList.remove('active', 'bg-black', 'text-white'));
        btn.classList.add('active', 'bg-black', 'text-white');

        const category = btn.dataset.category;
        posts.forEach(post => {
          const match = category === 'all' || post.dataset.category === category;
          post.style.display = match ? 'block' : 'none';
        });
      });
    });
  </script>

  <!-- 🔹 버튼 스타일 -->
  <style>
    .category-btn.active {
      background-color: black;
      color: white;
    }
  </style>
</Layout>
