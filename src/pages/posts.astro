---
import Layout from '../layouts/Layout.astro';

const postFiles = Object.entries(import.meta.glob('../content/posts/*.md', { eager: true }));

const posts = postFiles.map(([path, post]) => ({
  slug: path.split('/').pop().replace('.md', ''),
  ...post.frontmatter
}));

// ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ
const allCategories = [...new Set(posts.map(p => p.category ?? 'ê¸°íƒ€'))];
---

<Layout title="Blog">

  <!-- ðŸ”¹ Navigation -->
  <div id="category-nav" class="flex flex-wrap gap-2 mb-8">
    <button class="category-btn px-4 py-2 border rounded active" data-category="all">ëª¨ë“  ê¸€</button>
    {allCategories.map(cat => (
      <button class="category-btn px-4 py-2 border rounded" data-category={cat}>{cat}</button>
    ))}
  </div>

  <!-- ðŸ”¹ í¬ìŠ¤íŠ¸ ëª©ë¡ -->
  <div id="posts-wrapper" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
    {posts.map(post => (
      <a 
        href={`/posts/${post.slug}`} 
        class="group block border rounded-lg overflow-hidden shadow-sm hover:shadow-lg transition-shadow duration-300 post-card"
        data-category={post.category ?? 'ê¸°íƒ€'}
      >
        <div class="w-full aspect-square overflow-hidden">
          <img 
            src={post.image} 
            alt={post.title} 
            class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-300"
          />
        </div>
        <div class="p-4">
          <h3 class="text-base md:text-lg font-bold mb-1">{post.title}</h3>
          <p class="text-sm text-gray-600">{post.description}</p>
        </div>
      </a>
    ))}
  </div>

  <!-- ðŸ”¹ í•„í„° ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    const buttons = document.querySelectorAll('.category-btn');
    const posts = document.querySelectorAll('.post-card');

    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        // ë²„íŠ¼ í™œì„±í™” í‘œì‹œ
        buttons.forEach(b => b.classList.remove('active', 'bg-black', 'text-white'));
        btn.classList.add('active', 'bg-black', 'text-white');

        const category = btn.dataset.category;
        posts.forEach(post => {
          const match = category === 'all' || post.dataset.category === category;
          post.style.display = match ? 'block' : 'none';
        });
      });
    });
  </script>

  <!-- ðŸ”¹ ë²„íŠ¼ ìŠ¤íƒ€ì¼ -->
  <style>
    .category-btn.active {
      background-color: black;
      color: white;
    }
  </style>
</Layout>
