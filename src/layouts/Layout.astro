---
import '../styles/global.css';
import Analytics from '@vercel/analytics/astro';
const { title } = Astro.props;
const showNav = Astro.url.pathname !== '/';
const showFooter = Astro.url.pathname !== '/';
---

<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>{title ?? '한결'}</title>

    <style is:global>
      main { flex: 1 1 auto; min-height: 0; }
    </style>

    <style>
      :root{
        --nav-radius: 16px; /* postcard와 동일 */
        --nav-pad-x: 27px;  /* 내부 좌우 패딩 */
        --nav-pad-t: 22px;  /* 내부 상단 패딩 */
        --nav-pad-b: 22px;  /* 내부 하단 패딩(필요 시 0으로) */
        --nav-side-gap: 24px; /* 양옆 마진(상자 외부 여백) */
        --nav-gradient: linear-gradient(
          to bottom,
          #040404 0%,
          #040404 18%,
          #13151e 34%,
          #2f3756 50%,
          #747e89 80%,
          #c3c0ba 100%
        );
      }
      .layout-root {
        background: #ebe9e5;
        min-height: 100vh;
      }

      /* 배경 레일(페이지 톤 유지 + sticky) */
      .site-nav{
        position: sticky; top: 0; z-index: 50;
        background: transparent; /* 페이지 배경 */
        padding-top: 0; padding-left: 0; padding-right: 0; padding-bottom: 0;
      }

      /* 실제 네비 상자 */
      .site-nav-box{
        display:flex;
        justify-content:space-between;
        align-items:flex-start;
        margin: 0 max(var(--nav-side-gap), env(safe-area-inset-left)) 0 max(var(--nav-side-gap), env(safe-area-inset-right));
        background: var(--nav-gradient);
        border-radius: 0 0 var(--nav-radius) var(--nav-radius); /* 아래만 라운드 */
        padding: var(--nav-pad-t) var(--nav-pad-x) var(--nav-pad-b);
        box-sizing: border-box;

        -webkit-transform: translateZ(0);

        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.18);
        transition: box-shadow 0.25s ease, transform 0.25s ease;
      }

      .site-nav-box:hover {
        box-shadow: 6px 6px 10px rgba(0, 0, 0, 0.18);
        transform: translateY(-2px);
      }

      /* 좌측 브랜드 */
      .site-brand{
        display:flex; align-items:center; gap: 12px; min-width:0;
        text-decoration:none; color:#fff;
      }
      .brand-logo{
        height: clamp(28px, 3.7vw, 30px); width:auto; object-fit:contain; border-radius:0;
        filter: invert(1) brightness(1.05) contrast(1.05);
      }
      .brand-title{
        font-weight:500; font-size: clamp(22px, 3.5vw, 25px);
        letter-spacing:-0.02em; line-height:1; white-space:nowrap; color:#fff;
        overflow:hidden; text-overflow:ellipsis;
      }

      /* 검색창: 다크 배경 대비 */
      #search-form{
        position: relative; display:flex; align-items:center; flex:0 0 auto;
        width: min(11rem, 46vw); margin-top: 0;
      }
      #search-input{
        width:100%;
        font-size: clamp(14px, 3.6vw, 15px); line-height:1.1;
        padding: 0.5rem 2.0rem 0.5rem 0.9rem;
        border-radius: 9999px; border: 0;
        background: rgba(255,255,255,0.92); color:#111;
        outline: none; transition: box-shadow .2s, background .2s;
      }
      #search-input::placeholder{ color: rgba(0,0,0,.5); }
      #search-form button{
        position:absolute; right: .6rem; top:50%; transform: translateY(-50%);
        background:none; border:none; color:#111; cursor:pointer;
      }
      #search-form svg{ width:1rem; height:1rem; }

      #search-input:focus{ box-shadow: 0 0 0 0px rgba(255,255,255,.6), 0 0 0 5px rgba(0,0,0,.2) inset; }

      @media (max-width: 640px){
        .site-nav-box{ margin-inline: max(var(--nav-side-gap), 24px); }
        #search-form{ width: min(10rem, 52vw); }
      }
      @media (max-width: 400px){
        .site-nav-box{ margin-inline: max(var(--nav-side-gap), 20px); }
        #search-form{ width: min(9.2rem, 56vw); }
      }
    </style>
  </head>

  <body>
    <div class="layout-root">
      {showNav && (
        <nav class="site-nav">
          <div class="site-nav-box">
            <a href="/" class="site-brand" aria-label="홈">
              <img src="/images/website/logo.svg" alt="로고" class="brand-logo" />
              <span class="brand-title">한결</span>
            </a>

            <form id="search-form">
              <input type="search" placeholder="게시물 검색" id="search-input" />
              <button type="submit" aria-label="검색">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <circle cx="11" cy="11" r="7" stroke-width="2" />
                  <line x1="16.5" y1="16.5" x2="21" y2="21" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </button>
            </form>
          </div>
        </nav>
      )}

      <main>
        <slot />
      </main>

      {showFooter && (
        <footer style="
          background: #F8F8FF;
          border-top: 1px solid #eee;
          text-align: center;
          color: #999;
          font-size: 0.8rem;
          padding: 0.6rem 0 0.6rem 0;
          margin-top: 0;
          flex-shrink: 0;
        ">
          © {new Date().getFullYear()} 한결 | All rights reserved. | hanparkdesign@gmail.com
        </footer>
      )}
    </div>

    <Analytics/>

  <script>
  function enhanceVideo(video) {
    const existingWrapper = video.closest('.video-wrapper');
    if (existingWrapper) {
      return existingWrapper;
    }

    const wrapper = document.createElement('div');
    wrapper.className = 'video-wrapper';

    const parent = video.parentNode;
    if (!parent) return null;

    parent.insertBefore(wrapper, video);
    wrapper.appendChild(video);

    const overlay = document.createElement('div');
    overlay.className = 'video-play-overlay';
    wrapper.appendChild(overlay);

    const syncOverlay = () => {
      if (video.paused) {
        wrapper.classList.remove('is-playing');
      } else {
        wrapper.classList.add('is-playing');
      }
    };

    video.addEventListener('play', syncOverlay);
    video.addEventListener('pause', syncOverlay);
    video.addEventListener('ended', syncOverlay);

    syncOverlay();
    return wrapper;
  }

  // ✅ 여기 함수만 교체
  function setupVideoControls() {
    const videos = document.querySelectorAll('video');

    videos.forEach((video) => {
      // 1) 모바일에서 디폴트 UI 뜨는 핵심 원인 제거: controls 강제 삭제
      if (video.hasAttribute('controls')) {
        video.removeAttribute('controls');
      }

      // 2) 인라인 재생 강제 (iOS 전체 화면 진입 방지)
      video.setAttribute('playsinline', '');
      video.setAttribute('webkit-playsinline', '');

      // 필요하면 자동으로 muted도 기본값으로 줄 수 있음 (옵션)
      // if (!video.hasAttribute('muted')) {
      //   video.muted = true;
      // }

      // 3) 우리 커스텀 래퍼 + 오버레이 적용
      enhanceVideo(video);

      // 4) 중복 이벤트 방지
      if (video.dataset.hasListener) return;

      video.addEventListener('click', function (e) {
        e.preventDefault();
        e.stopPropagation();

        if (video.paused) {
          video.play();
        } else {
          video.pause();
        }
      });

      // 모바일 더블탭 확대 방지
      video.addEventListener('dblclick', function (e) {
        e.preventDefault();
      });

      video.dataset.hasListener = 'true';
    });
  }

  function setupAntiCopy() {
    document.addEventListener('contextmenu', function (e) {
      e.preventDefault();
    });

    function applyNoDrag() {
      document.querySelectorAll('img, video').forEach((el) => {
        el.setAttribute('draggable', 'false');
      });
    }
    applyNoDrag();

    document.addEventListener('keydown', function (e) {
      const key = e.key.toLowerCase();

      if ((e.ctrlKey || e.metaKey) && ['s', 'p', 'u', 'c'].includes(key)) {
        e.preventDefault();
      }

      if (key === 'f12') {
        e.preventDefault();
      }
    });
  }

  function setupAll() {
    setupVideoControls();
    setupAntiCopy();
  }

  document.addEventListener('astro:page-load', setupAll);
  document.addEventListener('DOMContentLoaded', setupAll);
</script>


    
  </body>
</html>
